# ç”µå•†æ•°æ®å¯è§†åŒ–çœ‹æ¿

ä¸€ä¸ªåŸºäº **FastAPI + React (Vite)** çš„å‰åç«¯åˆ†ç¦»äº¤äº’å¼æ•°æ®å¯è§†åŒ–çœ‹æ¿ï¼Œç”¨äºåˆ†æç”µå•†ç½‘ç«™çš„ç”¨æˆ·è¡Œä¸ºå’Œé”€å”®æ•°æ®ã€‚

## ğŸŒ åœ¨çº¿è®¿é—®

**äº‘ç«¯éƒ¨ç½²åœ°å€**ï¼š[https://mds-datavis-final-dashboard-1.onrender.com](https://mds-datavis-final-dashboard-1.onrender.com)

å¯ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼Œæ— éœ€æœ¬åœ°å®‰è£…ã€‚

## æ¶æ„æ¦‚è§ˆ

- **åç«¯**ï¼šFastAPI + DuckDB  
  - è´Ÿè´£æ•°æ®åŠ è½½ã€ç”¨æˆ·åˆ†ç¾¤ã€èšåˆè®¡ç®—åŠ Drill-down æ¥å£  
  - æ‰€æœ‰ API æš´éœ²åœ¨ `/api/*`ï¼Œé»˜è®¤ç«¯å£ `8000`
- **å‰ç«¯**ï¼šReact + TypeScript + TailwindCSS + Ant Design + ECharts + Framer Motion  
  - æ”¯æŒ Top N æŒ‡æ ‡åˆ‡æ¢ã€Drill-down æŠ½å±‰ã€å“åº”å¼å¸ƒå±€ä¸ç°ä»£åŒ–ä¸»é¢˜  
  - é€šè¿‡ `.env` (`VITE_API_BASE_URL`) æŒ‡å‘åç«¯ API
- **éƒ¨ç½²æ¨¡å¼**ï¼šå‰åç«¯åˆ†ç¦»
  - **å‰ç«¯**ï¼šå·²éƒ¨ç½²åˆ° Renderï¼Œé™æ€èµ„æºæ‰˜ç®¡
  - **åç«¯**ï¼šå¯éƒ¨ç½²åˆ° Render æˆ–å…¶ä»–äº‘æœåŠ¡

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒäº¤äº’åŠŸèƒ½

- **ç”¨æˆ·ç¾¤ä½“é€‰æ‹©**ï¼šå¯é€‰æ‹©ä¸åŒçš„æ¶ˆè´¹ç±»å‹ç”¨æˆ·ç¾¤ä½“ï¼ˆHesitantçŠ¹è±«å‹ã€Impulsiveå†²åŠ¨å‹ã€Collectoræ”¶è—å‹ï¼‰æˆ–å…¨éƒ¨ç”¨æˆ·
  - æ‚¬æµ®åœ¨ç”¨æˆ·ç¾¤ä½“å¡ç‰‡ä¸Šå¯æŸ¥çœ‹è¯¦ç»†è¯´æ˜
- **Top N æ§åˆ¶**ï¼šæ”¯æŒå®æ—¶åˆ‡æ¢æ’åæŒ‡æ ‡ï¼ˆæµè§ˆ/åŠ è´­/è´­ä¹°ï¼‰ä¸ Top N æ•°é‡ï¼ˆ3-30ï¼‰
  - æ‰€æœ‰æŒ‡æ ‡æŒ‰å›ºå®šé¡ºåºæ˜¾ç¤ºï¼šæµè§ˆ â†’ åŠ è´­ â†’ è´­ä¹°
- **æ—¥æœŸèŒƒå›´ç­›é€‰**ï¼šæ”¯æŒé€‰æ‹©æ—¥æœŸèŒƒå›´è¿›è¡Œæ•°æ®ç­›é€‰
  - é¢„è®¾å¿«æ·é€‰é¡¹ï¼šæ•°æ®é›†å…¨éƒ¨ã€2015å¹´5-7æœˆã€2015å¹´6-9æœˆã€æœ€è¿‘ä¸‰ä¸ªæœˆ
- **Drill-down æŠ½å±‰**ï¼šç‚¹å‡»å›¾è¡¨å…ƒç´ å¯åœ¨ä¾§è¾¹é¢æ¿ä¸­æŸ¥çœ‹è¯¦ç»†åˆ†æ
  - æ‰€æœ‰æŠ½å±‰æ”¯æŒä»å·¦ä¾§è¾¹ç•Œæ‹–æ‹½è°ƒæ•´å®½åº¦ï¼ˆ300-1200pxï¼‰
  - æŠ½å±‰å†…å®¹è‡ªé€‚åº”å®½åº¦å˜åŒ–
- **æ‰‹åŠ¨åˆ·æ–°**ï¼šæ‰€æœ‰å›¾è¡¨æ ¹æ®é€‰æ‹©çš„ç”¨æˆ·ç¾¤ä½“ã€æŒ‡æ ‡å’Œæ—¥æœŸèŒƒå›´æ›´æ–°ï¼Œæ”¯æŒæ‰‹åŠ¨åˆ·æ–°æŒ‰é’®
  - å…³é—­äº†çª—å£èšç„¦å’Œç½‘ç»œé‡è¿çš„è‡ªåŠ¨åˆ·æ–°ï¼Œå‡å°‘ä¸å¿…è¦çš„è¯·æ±‚
  - ç‚¹å‡»å³ä¸Šè§’åˆ·æ–°æŒ‰é’®å¯æ‰‹åŠ¨æ›´æ–°æ‰€æœ‰æ•°æ®
- **å“åº”å¼è®¾è®¡**ï¼šæ‰€æœ‰å›¾è¡¨æ”¯æŒçª—å£å¤§å°è‡ªé€‚åº”è°ƒæ•´
- **ç°ä»£ UI**ï¼šåŸºäº Urbanist å­—ä½“ä¸æ¸å˜è‰²ç³»çš„ç°ä»£åŒ–å¡ç‰‡å¼å¸ƒå±€ï¼Œæ”¯æŒæš—è‰²ä¸»é¢˜ï¼Œä½¿ç”¨ Framer Motion åŠ¨ç”»æ•ˆæœ
  - è‡ªå®šä¹‰ CUHKSZ å›¾æ ‡å’ŒèƒŒæ™¯
- **å¯æ‹–æ‹½å¸ƒå±€**ï¼šæ‰€æœ‰å›¾è¡¨å¡ç‰‡ï¼ˆåŒ…æ‹¬æŒ‡æ ‡å¡ç‰‡ï¼‰æ”¯æŒæ‹–æ‹½é‡æ–°æ’åˆ—ä½ç½®å’Œè°ƒæ•´å¤§å°
  - æŒ‡æ ‡å¡ç‰‡ï¼ˆæµè§ˆé‡ã€åŠ è´­é‡ã€è´­ä¹°é‡ï¼‰å¯ç‹¬ç«‹æ‹–æ‹½å’Œè°ƒæ•´åˆ—å¤§å°
  - å¸ƒå±€è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼Œåˆ·æ–°åä¿æŒ
- **å›¾è¡¨å¯¼å‡º**ï¼šæ”¯æŒå¯¼å‡ºå›¾è¡¨ä¸º PNG å›¾ç‰‡
  - ä½¿ç”¨ ECharts åŸç”Ÿå¯¼å‡º
- **æ‰‹åŠ¨åˆ·æ–°æ§åˆ¶**ï¼šå…³é—­è‡ªåŠ¨åˆ·æ–°ï¼Œä»…åœ¨ç‚¹å‡»åˆ·æ–°æŒ‰é’®æ—¶æ›´æ–°æ•°æ®
  - é¿å…ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚ï¼Œæå‡æ€§èƒ½

### ä¸»çœ‹æ¿å›¾è¡¨

1. **æ•°æ®æ¦‚è§ˆæŒ‡æ ‡å¡ç‰‡** - æ˜¾ç¤ºæµè§ˆã€åŠ è´­ã€è´­ä¹°ä¸‰ç§äº‹ä»¶ç±»å‹çš„æ€»æ•°ç»Ÿè®¡
   - é‡‡ç”¨åœ†å½¢è¿›åº¦ç¯é£æ ¼ï¼Œæ˜¾ç¤ºå„æŒ‡æ ‡å æ¯”å’Œæ•°å€¼
   - ä¸‰ä¸ªæŒ‡æ ‡å¡ç‰‡å¯ç‹¬ç«‹æ‹–æ‹½å’Œè°ƒæ•´å¤§å°ï¼Œæ”¯æŒè‡ªç”±å¸ƒå±€

2. **Top N å•†å“æ¦œ** - æ°´å¹³æŸ±çŠ¶å›¾æ˜¾ç¤ºé”€é‡/æµè§ˆ/åŠ è´­ Top N å•†å“
   - æ”¯æŒç‚¹å‡»å•†å“æŸ¥çœ‹è¯¦ç»† Drill-down åˆ†æ

3. **Top N å“ç±»æ¦œ** - æ°´å¹³æŸ±çŠ¶å›¾æ˜¾ç¤ºé”€é‡/æµè§ˆ/åŠ è´­ Top N ç±»åˆ«
   - æ”¯æŒç‚¹å‡»ç±»åˆ«æŸ¥çœ‹è¯¦ç»† Drill-down åˆ†æ

4. **è½¬æ¢ç‡æ¼æ–—** - è‡ªå®šä¹‰ SVG æ¼æ–—å›¾å±•ç¤ºæµè§ˆâ†’åŠ è´­â†’è´­ä¹°çš„è½¬åŒ–æµç¨‹
   - æ˜¾ç¤ºå„é˜¶æ®µæ•°é‡å’Œè½¬åŒ–ç‡
   - æ”¯æŒç‚¹å‡»é˜¶æ®µæŸ¥çœ‹è¯¦ç»†åˆ†æ

5. **ç”¨æˆ·æ´»è·ƒæ—¶é—´æ®µ** - æŠ˜çº¿å›¾å±•ç¤º 24 å°æ—¶å†…ç”¨æˆ·æ´»è·ƒåº¦åˆ†å¸ƒ
   - æ”¯æŒç‚¹å‡»æ—¶é—´æ®µæŸ¥çœ‹è¯¥æ—¶æ®µçš„è¯¦ç»†åˆ†æ

6. **ç”¨æˆ·ç•™å­˜ç‡ï¼ˆæœˆåº¦ï¼‰** - æŠ˜çº¿å›¾å±•ç¤ºä¸åŒæœˆä»½ç”¨æˆ·çš„æœˆåº¦ç•™å­˜ç‡æ›²çº¿
   - æ”¯æŒç‚¹å‡»æŠ˜çº¿æ•°æ®ç‚¹æŸ¥çœ‹è¯¥ Cohort çš„è¯¦ç»†è¡Œä¸ºåˆ†æ

7. **å‘¨ä¸€åˆ°å‘¨æ—¥ç”¨æˆ·æ•°** - æŸ±çŠ¶å›¾å±•ç¤ºä¸€å‘¨ä¸­å„å¤©çš„ç”¨æˆ·æ•°åˆ†å¸ƒ
   - æ˜¾ç¤ºå·¥ä½œæ—¥å¹³å‡å’Œå‘¨æœ«å¹³å‡å‚è€ƒçº¿
   - æ”¯æŒç‚¹å‡»æŸ±çŠ¶å›¾æŸ¥çœ‹è¯¥å¤©çš„è¯¦ç»†åˆ†æ

### Drill-down è¯¦æƒ…æŠ½å±‰

#### 1. å•†å“/ç±»åˆ«è¯¦æƒ…ï¼ˆDrilldownDrawerï¼‰

**å¯æ‹–æ‹½è°ƒæ•´å®½åº¦**ï¼šä»å·¦ä¾§è¾¹ç•Œæ‹–æ‹½å¯è°ƒæ•´æŠ½å±‰å®½åº¦

ç‚¹å‡» Top N å•†å“æˆ–ç±»åˆ«åå±•ç¤ºï¼š

- æ•°æ®æ¦‚è§ˆç»Ÿè®¡
- äº‹ä»¶ç±»å‹åˆ†å¸ƒï¼ˆæµè§ˆã€åŠ è´­ã€è´­ä¹°ï¼‰
- æ—¶é—´è¶‹åŠ¿å›¾ï¼ˆå‘¨åº¦æ´»åŠ¨é‡ï¼‰
- 24 å°æ—¶æ´»è·ƒåˆ†å¸ƒ
- ç”¨æˆ·ç¾¤ä½“åˆ†å¸ƒ

#### 2. æ¼æ–—é˜¶æ®µè¯¦æƒ…ï¼ˆFunnelStageDrawerï¼‰

ç‚¹å‡»æ¼æ–—å›¾çš„æŸä¸ªé˜¶æ®µåå±•ç¤ºï¼š

- é˜¶æ®µæ•°æ®ç»Ÿè®¡
- æ—¶é—´è¶‹åŠ¿å›¾
- 24 å°æ—¶æ´»è·ƒåˆ†å¸ƒ
- Top å•†å“å’Œç±»åˆ«
- ç”¨æˆ·ç¾¤ä½“åˆ†å¸ƒ

#### 3. æ´»è·ƒæ—¶é—´æ®µè¯¦æƒ…ï¼ˆActiveHourDrawerï¼‰

ç‚¹å‡»æ´»è·ƒæ—¶é—´æ®µå›¾è¡¨åå±•ç¤ºï¼š

- æ—¶é—´æ®µæ•°æ®æ¦‚è§ˆ
- äº‹ä»¶ç±»å‹åˆ†å¸ƒ
- è½¬åŒ–ç‡åˆ†æ
- å¯¹æ¯”åˆ†æï¼ˆä¸æ¯æ—¥å¹³å‡å¯¹æ¯”ï¼‰
- æ—¶é—´è¶‹åŠ¿å›¾ï¼ˆå‘¨åº¦ï¼‰
- è½¬åŒ–æ¼æ–—
- Top å•†å“å’Œç±»åˆ«
- ç”¨æˆ·ç¾¤ä½“åˆ†å¸ƒ

#### 4. ç”¨æˆ·ç•™å­˜ Cohort è¯¦æƒ…ï¼ˆCohortDetailDrawerï¼‰

ç‚¹å‡»ç•™å­˜ç‡å›¾è¡¨çš„æŸä¸ª Cohort åå±•ç¤ºï¼š

- Cohort æ•°æ®æ¦‚è§ˆ
- äº‹ä»¶ç»Ÿè®¡
- ç”¨æˆ·ç¾¤ä½“åˆ†
- è½¬åŒ–ç‡åˆ†æ
- æ—¶é—´è¶‹åŠ¿å›¾
- Top å•†å“å’Œç±»åˆ«

#### 5. æ˜ŸæœŸå‡ è¯¦æƒ…ï¼ˆWeekdayDetailDrawerï¼‰

ç‚¹å‡»å‘¨ä¸€åˆ°å‘¨æ—¥ç”¨æˆ·æ•°å›¾è¡¨çš„æŸä¸€å¤©åå±•ç¤ºï¼š

- äº‹ä»¶æ¦‚è§ˆç»Ÿè®¡
- ç”¨æˆ·ç¾¤ä½“åˆ†å¸ƒ
- è½¬åŒ–ç‡åˆ†æ
- å¯¹æ¯”åˆ†æï¼ˆä¸å·¥ä½œæ—¥å¹³å‡ã€å‘¨æœ«å¹³å‡ã€ä¸€å‘¨å¹³å‡å¯¹æ¯”ï¼‰
- 24 å°æ—¶æ´»è·ƒåˆ†å¸ƒ
- æ—¶é—´è¶‹åŠ¿å›¾ï¼ˆå‘¨åº¦ï¼‰
- è½¬åŒ–æ¼æ–—
- Top å•†å“å’Œç±»åˆ«

## ç”¨æˆ·åˆ†ç±»è¯´æ˜

ç³»ç»Ÿæ ¹æ®ç”¨æˆ·è¡Œä¸ºç‰¹å¾è‡ªåŠ¨å°†ç”¨æˆ·åˆ†ä¸ºä¸‰ç±»ï¼š

- **Allï¼ˆå…¨éƒ¨ç”¨æˆ·ï¼‰**ï¼šæ‰€æœ‰ç”¨æˆ·ç¾¤ä½“çš„æ±‡æ€»æ•°æ®
- **Hesitantï¼ˆçŠ¹è±«å‹ï¼‰**ï¼šæµè§ˆè¾ƒå¤šä½†è½¬åŒ–ç‡è¾ƒä½ï¼Œéœ€è¦æ›´å¤šå¼•å¯¼ã€‚æµè§ˆå¤šä½†è´­ä¹°å°‘ï¼Œè´­ä¹°ç‡ä½äº 5%
- **Impulsiveï¼ˆå†²åŠ¨å‹ï¼‰**ï¼šæµè§ˆåå¿«é€ŸåŠ è´­å’Œè´­ä¹°ï¼Œè½¬åŒ–ç‡é«˜ã€‚è´­ä¹°ç‡é«˜äº 30%ï¼Œ24 å°æ—¶å†…å®Œæˆè´­ä¹°
- **Collectorï¼ˆæ”¶è—å‹ï¼‰**ï¼šå–œæ¬¢åŠ è´­ä½†è´­ä¹°å†³ç­–å‘¨æœŸè¾ƒé•¿ã€‚åŠ è´­æ¬¡æ•° â‰¥ 5 æ¬¡ï¼Œè´­ä¹°ç‡ â‰¥ 10%

> æç¤ºï¼šåœ¨ç­›é€‰æ ä¸­æ‚¬æµ®åœ¨ç”¨æˆ·ç¾¤ä½“å¡ç‰‡ä¸Šå¯æŸ¥çœ‹è¯¦ç»†è¯´æ˜

## å®‰è£…å’Œè¿è¡Œ

### æ–¹å¼ä¸€ï¼šåœ¨çº¿è®¿é—®

ç›´æ¥è®¿é—®äº‘ç«¯éƒ¨ç½²åœ°å€ï¼š[**https://mds-datavis-final-dashboard-1.onrender.com**](https://mds-datavis-final-dashboard-1.onrender.com)

æ— éœ€ä»»ä½•å®‰è£…é…ç½®ï¼Œæ‰“å¼€æµè§ˆå™¨å³å¯ä½¿ç”¨ã€‚

### æ–¹å¼äºŒï¼šæœ¬åœ°è¿è¡Œ

#### å‰ç½®è¦æ±‚

- Python 3.10+
- Node.js 16+
- Git LFSï¼ˆç”¨äºæ‹‰å–å¤§æ–‡ä»¶ï¼‰

#### è¿è¡Œæ­¥éª¤

1. **å…‹éš†ä»“åº“**
   ```bash
   git clone https://github.com/chenxc-cxc/mds_datavis_final_dashboard
   cd mds_datavis_final_dashboard
   ```

2. **æ‹‰å–æ•°æ®æ–‡ä»¶**
   ```bash
   git lfs pull
   ```

3. **å®‰è£…åç«¯ä¾èµ–å¹¶å¯åŠ¨**
   ```bash
   cd backend
   pip install -r requirements.txt
   uvicorn app.main:app --reload --port 8000
   ```

   æ¥å£æ–‡æ¡£ï¼š`http://127.0.0.1:8000/api/docs`

4. **å®‰è£…å‰ç«¯ä¾èµ–å¹¶å¯åŠ¨**ï¼ˆæ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼‰
   ```bash
   cd frontend
   npm install   # é¦–æ¬¡è¿è¡Œ
   npm run dev
   ```

5. **è®¿é—®åº”ç”¨**

   è®¿é—®ç¬¬ 4 æ­¥ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„æœ¬åœ°å¼€å‘æœåŠ¡å™¨åœ°å€ï¼ˆé€šå¸¸æ˜¯ `http://localhost:5173`ï¼‰

#### æ•°æ®æ–‡ä»¶è¯´æ˜

æ•°æ®æ–‡ä»¶ä½äº `backend/archive/events_with_category.csv`(æœªæ”¾å…¥)ï¼Œæ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š

```text
timestamp,visitorid,event,itemid,categoryid
2015-06-02 05:02:12,257597,view,355908,1173
2015-06-02 05:50:14,992329,view,248676,1231
2015-06-02 04:57:58,158090,addtocart,10572,1037
2015-06-01 21:18:20,121688,transaction,15335,1098
```

æ•°æ® duckbd æ–‡ä»¶é€šè¿‡ Git LFS ç®¡ç†ï¼Œä½¿ç”¨ `git lfs pull` æ‹‰å–ã€‚

#### ç¯å¢ƒå˜é‡é…ç½®

å‰ç«¯é»˜è®¤ä¼šè¿æ¥ `http://localhost:8000/api`ï¼Œå¦‚éœ€ä¿®æ”¹åç«¯åœ°å€ï¼Œå¯åœ¨ `frontend/.env` ä¸­è®¾ç½®ï¼š

```bash
VITE_API_BASE_URL=http://localhost:8000/api
```


## é¡¹ç›®ç»“æ„

```text
project/
â”œâ”€â”€ backend/                    # FastAPI åç«¯
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚   â”‚       â””â”€â”€ metrics.py      # API è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â””â”€â”€ config.py           # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â””â”€â”€ schemas.py          # Pydantic æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ cache.py            # Redis ç¼“å­˜æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ data_service.py     # DuckDB æ•°æ®æŸ¥è¯¢æœåŠ¡
â”‚   â”‚   â””â”€â”€ main.py                 # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ archive/                    # æ•°æ®æ–‡ä»¶ç›®å½•
â”‚   â”‚   â””â”€â”€ events_with_category.csv
â”‚   â”œâ”€â”€ cache/                      # è‡ªåŠ¨ç”Ÿæˆçš„ç¼“å­˜æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ events.duckdb           # DuckDB æ•°æ®åº“æ–‡ä»¶
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ frontend/                   # React + Vite å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts           # API å®¢æˆ·ç«¯é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ endpoints.ts        # API ç«¯ç‚¹å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ types.ts            # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ charts/             # å›¾è¡¨ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BarChart.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FunnelChart.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LineChart.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RetentionChart.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ WeekdayUserChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ActiveHourDrawer.tsx        # æ´»è·ƒæ—¶é—´æ®µè¯¦æƒ…æŠ½å±‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ChartCard.tsx               # å›¾è¡¨å¡ç‰‡å®¹å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ CohortDetailDrawer.tsx      # Cohort è¯¦æƒ…æŠ½å±‰
â”‚   â”‚   â”‚   â”œâ”€â”€ DateRangePicker.tsx         # æ—¥æœŸèŒƒå›´é€‰æ‹©å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ DrilldownDrawer.tsx         # å•†å“/ç±»åˆ«è¯¦æƒ…æŠ½å±‰
â”‚   â”‚   â”‚   â”œâ”€â”€ DraggableGrid.tsx           # å¯æ‹–æ‹½å›¾è¡¨ç½‘æ ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ FilterBar.tsx               # ç­›é€‰æ ï¼ˆç”¨æˆ·ç¾¤ä½“ã€æŒ‡æ ‡ã€TopNï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ FunnelStageDrawer.tsx       # æ¼æ–—é˜¶æ®µè¯¦æƒ…æŠ½å±‰
â”‚   â”‚   â”‚   â”œâ”€â”€ MetricsGrid.tsx             # æŒ‡æ ‡å¡ç‰‡ç½‘æ ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ ParticlesBackground.tsx     # ç²’å­èƒŒæ™¯åŠ¨ç”»
â”‚   â”‚   â”‚   â”œâ”€â”€ RefreshIndicator.tsx        # åˆ·æ–°æŒ‡ç¤ºå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ CUHKSZIcon.tsx              # CUHKSZ è‡ªå®šä¹‰å›¾æ ‡ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ CUHKSZIcon.css              # CUHKSZ å›¾æ ‡æ ·å¼å’ŒåŠ¨ç”»
â”‚   â”‚   â”‚   â”œâ”€â”€ CUHKSZBackground.tsx        # CUHKSZ èƒŒæ™¯ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ WeekdayDetailDrawer.tsx     # æ˜ŸæœŸå‡ è¯¦æƒ…æŠ½å±‰
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useResizableDrawer.tsx      # å¯æ‹–æ‹½è°ƒæ•´å¤§å°çš„æŠ½å±‰ Hook
â”‚   â”‚   â”‚   â””â”€â”€ useResizeChart.ts            # å›¾è¡¨å“åº”å¼è°ƒæ•´ Hook
â”‚   â”‚   â”œâ”€â”€ App.tsx                 # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ App.css                 # åº”ç”¨æ ·å¼
â”‚   â”‚   â””â”€â”€ main.tsx                # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## åç«¯ API ç«¯ç‚¹

æ‰€æœ‰ API ç«¯ç‚¹å‡ä½äº `/api/` è·¯å¾„ä¸‹ï¼š

### åŸºç¡€æŸ¥è¯¢

- `GET /api/segments` - è·å–ç”¨æˆ·ç¾¤ä½“ç»Ÿè®¡æ‘˜è¦
- `GET /api/top-items` - è·å– Top N å•†å“
- `GET /api/top-categories` - è·å– Top N ç±»åˆ«
- `GET /api/funnel` - è·å–è½¬åŒ–æ¼æ–—æ•°æ®
- `GET /api/event-counts` - è·å–äº‹ä»¶ç»Ÿè®¡ï¼ˆæµè§ˆã€åŠ è´­ã€è´­ä¹°æ€»æ•°ï¼‰
- `GET /api/active-hours` - è·å– 24 å°æ—¶æ´»è·ƒæ—¶é—´æ®µåˆ†å¸ƒ
- `GET /api/monthly-retention` - è·å–æœˆåº¦ç”¨æˆ·ç•™å­˜ç‡
- `GET /api/weekday-users` - è·å–å‘¨ä¸€åˆ°å‘¨æ—¥ç”¨æˆ·æ•°åˆ†å¸ƒ

### Drill-down è¯¦æƒ…

- `GET /api/drilldown/{entity_type}/{entity_id}` - è·å–å•†å“/ç±»åˆ«è¯¦æƒ…
  - `entity_type`: `item` æˆ– `category`
  - `entity_id`: å•†å“æˆ–ç±»åˆ« ID
- `GET /api/funnel-stage/{stage}` - è·å–æ¼æ–—é˜¶æ®µè¯¦æƒ…
  - `stage`: `view`, `addtocart`, æˆ– `transaction`
- `GET /api/active-hour/{hour}` - è·å–æ´»è·ƒæ—¶é—´æ®µè¯¦æƒ…
  - `hour`: 0-23 çš„å°æ—¶æ•°
- `GET /api/cohort-detail/{cohort_month}` - è·å– Cohort è¯¦æƒ…
  - `cohort_month`: æ ¼å¼ä¸º `YYYY-MM`ï¼ˆå¦‚ `2015-06`ï¼‰
- `GET /api/weekday-detail/{weekday}` - è·å–æ˜ŸæœŸå‡ è¯¦æƒ…
  - `weekday`: 1-7ï¼ˆ1=å‘¨ä¸€ï¼Œ7=å‘¨æ—¥ï¼‰

### é€šç”¨æŸ¥è¯¢å‚æ•°

æ‰€æœ‰ç«¯ç‚¹æ”¯æŒä»¥ä¸‹å¯é€‰å‚æ•°ï¼š

- `segment`: ç”¨æˆ·ç¾¤ä½“ï¼ˆ`All`, `Hesitant`, `Impulsive`, `Collector`ï¼‰ï¼Œé»˜è®¤ä¸º `All`
- `date_from`: å¼€å§‹æ—¥æœŸï¼ˆæ ¼å¼ï¼š`YYYY-MM-DD`ï¼‰
- `date_to`: ç»“æŸæ—¥æœŸï¼ˆæ ¼å¼ï¼š`YYYY-MM-DD`ï¼‰
- `metric`: æŒ‡æ ‡ç±»å‹ï¼ˆ`view`, `addtocart`, `transaction`ï¼‰ï¼Œä»…ç”¨äº Top N æŸ¥è¯¢ï¼Œé»˜è®¤ä¸º `transaction`
- `limit` / `top_n`: Top N æ•°é‡ï¼ŒèŒƒå›´ 3-30ï¼Œé»˜è®¤ä¸º 10

## æŠ€æœ¯æ ˆ

### åç«¯

- **FastAPI**: ç°ä»£ã€å¿«é€Ÿçš„ Web æ¡†æ¶
- **DuckDB**: é«˜æ€§èƒ½åˆ—å¼æ•°æ®åº“ï¼Œç”¨äºæ•°æ®åˆ†ææŸ¥è¯¢
- **Redis**: å†…å­˜ç¼“å­˜ï¼ŒåŠ é€Ÿçƒ­ç‚¹æŸ¥è¯¢
- **Pydantic**: æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–
- **Python 3.10+**

### å‰ç«¯

- **React 18**: UI æ¡†æ¶
- **TypeScript**: ç±»å‹å®‰å…¨
- **Vite**: æ„å»ºå·¥å…·å’Œå¼€å‘æœåŠ¡å™¨
- **ECharts**: æ•°æ®å¯è§†åŒ–å›¾è¡¨åº“
- **Ant Design**: UI ç»„ä»¶åº“
- **TailwindCSS**: å®ç”¨ä¼˜å…ˆçš„ CSS æ¡†æ¶
- **Framer Motion**: åŠ¨ç”»åº“
- **React Query (TanStack Query)**: æ•°æ®è·å–å’ŒçŠ¶æ€ç®¡ç†
- **Day.js**: æ—¥æœŸå¤„ç†åº“
- **html2canvas**: ç”¨äºé ECharts ç»„ä»¶çš„å›¾ç‰‡å¯¼å‡º

## æ€§èƒ½ä¼˜åŒ–

1. **DuckDB åˆ—å¼å­˜å‚¨**
   é¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨å°† CSV è½¬æ¢ä¸º DuckDB æ ¼å¼ï¼ŒæŸ¥è¯¢é€Ÿåº¦æå‡æ˜¾è‘—ã€‚

2. **ç”¨æˆ·åˆ†ç¾¤ç»“æœç¼“å­˜**
   ç”¨æˆ·åˆ†ç±»ç»“æœä¼šåºåˆ—åŒ–ä¸º `cache/user_segments.pkl`ï¼ˆå¸¦æ•°æ®æ–‡ä»¶ mtime ä¸é˜ˆå€¼å“ˆå¸Œï¼‰ï¼Œåç»­å¯åŠ¨ç›´æ¥å¤ç”¨ï¼Œé¿å…é‡å¤èšåˆå¤§é‡ç”¨æˆ·ã€‚

3. **Redis äºŒçº§ç¼“å­˜**
   FastAPI å±‚å¯¹çƒ­ç‚¹æ¥å£ï¼ˆTopNã€Funnelã€Drill-downï¼‰å¢åŠ  Redis TTL ç¼“å­˜ï¼Œè¿›ä¸€æ­¥å‡è½» DuckDB æŸ¥è¯¢å‹åŠ›ã€‚

4. **å“åº”å¼å›¾è¡¨**
   æ‰€æœ‰å›¾è¡¨ä½¿ç”¨ `ResizeObserver` è‡ªåŠ¨é€‚é…å®¹å™¨å¤§å°å˜åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°ã€‚

5. **æŒ‰éœ€åŠ è½½**
   Drill-down è¯¦æƒ…ä»…åœ¨ç”¨æˆ·ç‚¹å‡»æ—¶åŠ è½½ï¼Œå‡å°‘åˆå§‹æ¸²æŸ“å‹åŠ›ã€‚

6. **React Query ç¼“å­˜**
   å‰ç«¯ä½¿ç”¨ React Query è¿›è¡Œè¯·æ±‚å»é‡å’Œç¼“å­˜ï¼Œé¿å…é‡å¤è¯·æ±‚ã€‚

7. **ä¼˜åŒ–çš„å›¾ç‰‡å¯¼å‡º**
   ä½¿ç”¨ ECharts åŸç”Ÿ canvas å¯¼å‡ºåŠŸèƒ½ï¼Œç¡®ä¿å›¾è¡¨å¯¼å‡ºæ—¶å›¾ç‰‡è´¨é‡é«˜ä¸”æ— é”™ä½é—®é¢˜ã€‚

## ç¼“å­˜çº§åˆ«è¯´æ˜

```text
1. æµè§ˆå™¨å†…å­˜ (React Query) â† æœ€å¿«ï¼Œä»…å‰ç«¯
   â†“ (æœªå‘½ä¸­)
2. Redis å†…å­˜ç¼“å­˜ â† å¿«é€Ÿï¼Œè·¨è¯·æ±‚å…±äº« (ç›®å‰ç¦ç”¨ä¸­)
   â†“ (æœªå‘½ä¸­)
3. DuckDB æ•°æ®åº“æ–‡ä»¶ â† æ•°æ®æŒä¹…åŒ–å­˜å‚¨
   â†“ (åˆå§‹åŒ–æ—¶)
4. Parquet/CSV æºæ–‡ä»¶ â† åŸå§‹æ•°æ®æº
```

## æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡è¿è¡Œ**ï¼šè‹¥é€‰æ‹©åœ¨`backend/archive`ä¸­æ”¾å…¥åŸå§‹ csv æ–‡ä»¶,ä¸”åˆ é™¤äº† DuckDB æ–‡ä»¶,é¦–æ¬¡è¿è¡Œä¼šç”Ÿæˆ DuckDB æ•°æ®åº“æ–‡ä»¶å’Œç”¨æˆ·åˆ†ç¾¤è¡¨ï¼Œè€—æ—¶å–å†³äºç¡¬ä»¶ï¼ˆé€šå¸¸ 1~2 åˆ†é’Ÿï¼‰ï¼›å®Œæˆåå†æ¬¡å¯åŠ¨çº¦ 5~8 ç§’
2. **å†…å­˜è¦æ±‚**ï¼šå»ºè®®ä½¿ç”¨è‡³å°‘ 4GB å†…å­˜çš„æœåŠ¡å™¨è¿è¡Œ
3. **æ•°æ®åº“æ–‡ä»¶**ï¼šé€šè¿‡ Git LFS ç®¡ç†ï¼Œä½¿ç”¨ `git lfs pull` æ‹‰å–å¤§æ–‡ä»¶
4. **é…ç½®**ï¼šæ•°æ®æ–‡ä»¶è·¯å¾„ã€ç¼“å­˜ç›®å½•å¯åœ¨ `backend/app/core/config.py` ä¸­é…ç½®
5. **åç«¯ä¾èµ–**ï¼šDrill-down åŠŸèƒ½éœ€è¦åç«¯ APIï¼›æœ¬åœ°è¿è¡Œæ—¶è¯·ç¡®ä¿ FastAPI å·²å¯åŠ¨
6. **ç«¯å£**ï¼šå‰ç«¯å¼€å‘æœåŠ¡å™¨é»˜è®¤ç«¯å£ä¸º 5173ï¼Œåç«¯ API é»˜è®¤ç«¯å£ä¸º 8000
8. **æŠ½å±‰åŠŸèƒ½**ï¼šæ‰€æœ‰æŠ½å±‰ï¼ˆDrawerï¼‰æ”¯æŒä»å·¦ä¾§è¾¹ç•Œæ‹–æ‹½è°ƒæ•´å®½åº¦ï¼ŒèŒƒå›´ 300-1200px
9. **å¸ƒå±€ä¿å­˜**ï¼šå›¾è¡¨å¸ƒå±€ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ï¼Œåˆ·æ–°åä¿æŒ
